샤딩은 인터페이스 관점에서 보면 여러 데이터베이스가 있지만, **애플리케이션에서 보았을 때는 하나의 데이터베이스처럼 동작**하도록 설계됩니다. 이를 통해 샤딩은 분산된 데이터베이스 아키텍처의 복잡성을 애플리케이션에서 숨기는 역할을 합니다.

---

## **샤딩이란?**

샤딩(Sharding)은 데이터를 여러 데이터베이스나 서버로 분산 저장하는 기술입니다. 각각의 데이터베이스를 **샤드(Shard)**라고 부르며, 각 샤드는 전체 데이터의 부분집합을 저장합니다.

---

## **샤딩의 인터페이스 관점**

### **1. 논리적 관점에서 단일 데이터베이스처럼 보임**

- **애플리케이션 입장**:
    - 샤딩된 데이터베이스는 애플리케이션 레벨에서 하나의 데이터베이스로 인식됩니다.
    - 개발자는 SQL 쿼리나 ORM(JPA, Hibernate 등)을 사용할 때 샤드의 개수나 위치를 신경 쓰지 않아도 됩니다.
- **예**:
  ```sql
  SELECT * FROM users WHERE id = 123;
```
    - 애플리케이션은 `id=123`의 데이터를 요청하면, 샤딩 로직에 의해 올바른 샤드로 쿼리가 전달됩니다.

---

### **2. 물리적 관점에서 여러 데이터베이스로 나뉨**

- **데이터 분산**:
    - 데이터는 샤딩 키(Sharding Key, 예: `id` 또는 `user_id`)를 기반으로 각 샤드에 분산됩니다.
    - 샤드별로 독립된 데이터베이스 인스턴스나 물리적 서버를 사용.
- **샤딩 로직**:
    - 샤드 선택은 **애플리케이션**이나 **샤딩 미들웨어**에서 처리됩니다.
    - 예: `id % 샤드 수`를 사용해 데이터를 특정 샤드로 라우팅.

---

## **샤딩 동작 방식**

### **1. 샤딩 키를 통한 라우팅**

- 데이터는 샤딩 키에 따라 적절한 샤드로 분배됩니다.
- 예:
    - 샤딩 키: `id`
    - 샤드 수: 3
    - 라우팅 로직: `id % 3`
    - 결과:
        - `id=1` → 샤드 1
        - `id=2` → 샤드 2
        - `id=3` → 샤드 0

### **2. 샤딩 미들웨어**

- 샤딩 미들웨어(예: **Mycat**, **ShardingSphere**, **Vitess**)를 사용하면, 샤드의 분산 로직이 애플리케이션에서 추상화됩니다.
- 애플리케이션은 샤딩 미들웨어를 통해 쿼리를 실행하며, 미들웨어가 올바른 샤드로 쿼리를 라우팅.
- 예:
    - 애플리케이션 → 미들웨어 → 샤드 1, 샤드 2, 샤드 3

---

## **샤딩의 장점과 단점**

### **장점**

1. **확장성**:
    - 데이터를 여러 서버로 분산하여 수평 확장이 가능.
2. **성능 향상**:
    - 샤드별로 데이터가 분산되므로, 각 데이터베이스의 부하가 감소.
3. **독립성**:
    - 각 샤드는 독립적으로 관리되며, 특정 샤드 장애가 전체 시스템에 영향을 주지 않을 수 있음.

---

### **단점**

1. **복잡성 증가**:
    - 샤딩 로직, 데이터 분배, 샤드 간 쿼리 통합 등이 복잡해짐.
2. **조인(Query Join) 제한**:
    - 샤드 간 데이터를 조인하려면 애플리케이션이나 미들웨어에서 추가 작업 필요.
    - 예: `id`가 다른 샤드에 분산되어 있으면 하나의 SQL로 조인이 불가능.
3. **재샤딩 문제**:
    - 샤드 수를 변경(추가/삭제)하면 기존 데이터를 다시 분배해야 함.
4. **트랜잭션 제약**:
    - 글로벌 트랜잭션 관리가 어려움. (2PC, 분산 트랜잭션 필요)

---

## **샤딩을 단일 데이터베이스처럼 보이게 하기 위한 기술**

1. **미들웨어 기반 샤딩 솔루션**:
    
    - ShardingSphere, Vitess 등은 샤드를 하나의 논리적 데이터베이스처럼 보이게 처리.
    - 샤드 라우팅, 샤드 간 조인, 글로벌 트랜잭션 지원.
2. **ORM 확장 기능**:
    
    - Hibernate, MyBatis 등은 샤딩을 지원하는 확장 기능을 제공.
    - 특정 샤드에 대한 쿼리를 작성하거나, 샤드 간 데이터 처리를 ORM 수준에서 추상화.

---

## **요약**

- **샤딩은 인터페이스 관점에서 단일 데이터베이스처럼 보일 수 있음**:
    - 샤딩 미들웨어나 애플리케이션 레벨에서 샤드 라우팅과 분배를 처리.
    - 개발자는 샤드의 물리적 분산을 인식하지 않아도 SQL 또는 ORM을 그대로 사용할 수 있음.
- 하지만 물리적으로는 여러 데이터베이스로 나뉘며, **조인, 트랜잭션 관리, 데이터 재분배** 등의 복잡성이 존재.

샤딩은 수평 확장에 강력한 솔루션이지만, 구현과 운영에는 신중한 설계가 필요합니다.