멀티프로세스의 컨텍스트 스위칭이 왜 필요한지, 그리고 어떤 비용이 발생하는지 자세히 설명드리겠습니다. **프로세스 간 컨텍스트 스위칭**은 멀티프로세스 환경에서 필연적으로 발생하며, 멀티쓰레드에서의 컨텍스트 스위칭과는 다른 이유로 비용이 발생합니다.

---

## **1. 멀티프로세스에서 컨텍스트 스위칭이 필요한 이유**

### **1.1 CPU의 단일 실행**

CPU는 동시에 하나의 프로세스(또는 쓰레드)만 실행할 수 있습니다. 따라서 여러 프로세스가 실행 중일 때:

1. 하나의 프로세스가 실행되고 있는 동안 다른 프로세스는 대기 상태로 전환됩니다.
2. OS는 대기 중인 프로세스들 중 하나를 선택하여 CPU를 할당해야 합니다.
3. 이 과정에서 현재 실행 중인 프로세스의 **컨텍스트(상태)**를 저장하고, 새로 실행할 프로세스의 **컨텍스트(상태)**를 로드합니다.

---

### **1.2 프로세스 간 컨텍스트 스위칭의 필수 조건**

- 각 프로세스는 **독립된 메모리 공간**을 사용하므로, 프로세스가 전환될 때:
    1. 현재 프로세스의 레지스터 상태(프로그램 카운터, 스택 포인터 등)를 저장.
    2. 새 프로세스의 레지스터 상태를 복원.
    3. 메모리 매핑 정보(Page Table)를 변경.

---

## **2. 멀티프로세스 컨텍스트 스위칭 비용의 주요 원인**

### **2.1 프로세스 상태 저장 및 복원**

1. **CPU 레지스터 저장 및 복원**:
    
    - 현재 프로세스의 레지스터 값(프로그램 카운터, 스택 포인터 등)을 저장.
    - 대기 중인 프로세스의 레지스터 값을 복원.
    - 이 과정은 쓰레드 컨텍스트 스위칭과 유사.
2. **메모리 주소 공간 전환**:
    
    - 멀티프로세스는 각 프로세스가 독립된 메모리 주소 공간을 가짐.
    - 프로세스 전환 시, OS는 CPU의 메모리 관리 장치(MMU, Memory Management Unit)에 새로운 페이지 테이블을 설정해야 함.
    - 이 과정에서 TLB(Translation Lookaside Buffer, 캐시) 무효화 비용이 발생.

---

### **2.2 프로세스 간 격리 유지**

- 멀티프로세스는 서로 메모리 공간을 공유하지 않기 때문에, 컨텍스트 스위칭 중에:
    1. **캐시 플러시**:
        - 이전 프로세스의 데이터가 CPU 캐시에 남아 있을 수 있으므로, 이를 비우고 새 프로세스의 데이터를 로드.
    2. **페이지 테이블 스위칭**:
        - 각 프로세스는 고유한 페이지 테이블을 가지므로, 새로운 프로세스에 적합한 메모리 맵핑 설정.

---

### **2.3 스케줄링 비용**

- OS 스케줄러는 다음 실행할 프로세스를 선택하기 위해 프로세스 우선순위, 상태, 대기 시간 등을 평가.
- 프로세스 스케줄링은 쓰레드 스케줄링보다 더 복잡하고 비용이 많이 듦.

---

## **3. 멀티프로세스 컨텍스트 스위칭 vs 멀티쓰레드 컨텍스트 스위칭**

|**특징**|**멀티프로세스 컨텍스트 스위칭**|**멀티쓰레드 컨텍스트 스위칭**|
|---|---|---|
|**스위칭 단위**|독립된 프로세스 전체|동일 프로세스 내의 쓰레드|
|**메모리 주소 공간**|전환 필요 (페이지 테이블 변경)|공유 메모리 (전환 필요 없음)|
|**레지스터 스위칭**|필요|필요|
|**캐시 플러시**|필요 (프로세스 간 격리 유지)|필요 없음 (공유 캐시 사용)|
|**스케줄링 비용**|높음 (독립 프로세스 관리)|낮음 (프로세스 내부 스케줄링)|

---

## **4. 구체적인 비용 요소**

### **4.1 페이지 테이블 전환**

- **멀티프로세스**는 각 프로세스마다 독립된 메모리 주소 공간을 사용하므로, CPU의 MMU가 새로운 페이지 테이블을 로드해야 합니다.
- TLB 캐시는 페이지 테이블의 일부를 저장하므로, 프로세스 전환 시 TLB 무효화 비용이 발생.

### **4.2 CPU 캐시 무효화**

- CPU 캐시는 이전 프로세스의 데이터를 저장하고 있을 수 있습니다.
- 멀티프로세스는 메모리 공간을 공유하지 않으므로, 컨텍스트 스위칭 시 CPU 캐시를 비우고 새 데이터를 로드해야 합니다.

---

## **5. 컨텍스트 스위칭의 실제 비용**

컨텍스트 스위칭의 비용은 CPU의 속도, 캐시 구조, 운영 체제의 효율성에 따라 다르지만, 일반적으로 다음과 같습니다:

- **멀티쓰레드 컨텍스트 스위칭**: 수십에서 수백 나노초.
- **멀티프로세스 컨텍스트 스위칭**: 수백 나노초에서 마이크로초 단위.

---

## **6. 결론**

**멀티프로세스에서도 컨텍스트 스위칭이 필요한 이유**는 CPU가 하나의 프로세스에서 다른 프로세스로 전환할 때, **레지스터 상태와 메모리 주소 공간을 변경해야 하기 때문**입니다. 멀티쓰레드보다 **메모리 격리로 인한 추가 작업(캐시 플러시, 페이지 테이블 전환)**이 필요하므로 더 많은 비용이 발생합니다.

결론적으로, 멀티프로세스에서의 컨텍스트 스위칭은 단일 CPU가 여러 프로세스를 순차적으로 실행해야 하기 때문에 필연적입니다. 멀티쓰레드와 비교하면 더 무겁지만, 격리성과 안정성을 제공하는 대가로 받아들여집니다.